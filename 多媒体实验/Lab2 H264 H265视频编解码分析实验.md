# 实验2：H264/H265视频编解码分析实验
## 1 选择YUV格式视频
[YUV Sequences](http://trace.eas.asu.edu/yuv/)
![image.png](https://wanwurong.oss-cn-beijing.aliyuncs.com/picgo/202305171533166.png)
5个文件我分别解压出来了，然后放入source文件夹
![image.png](https://wanwurong.oss-cn-beijing.aliyuncs.com/picgo/202305171534490.png)
## 2 使用H264编码器进行压缩
我用python代码调用FFmpeg进行YUV压缩，下面是代码：
```python
import subprocess  
import os  
  
def get_file_index(dir, file_extension):  
current_dir = dir  
  
# 初始化索引字典  
file_index = {}  
  
# 遍历当前目录下的所有文件和子目录  
for root, dirs, files in os.walk(current_dir):  
for file in files:  
# 获取文件路径  
file_path = os.path.join(root, file)  
if file.endswith(file_extension):  
# 将文件路径添加到索引字典中  
file_index[file] = file_path  
return file_index  
def compress_yuv_with_h264(input_file, output_file, width, height, bit_rate, output_format):  
# 使用FFmpeg对YUV进行H.264压缩  
command = [  
'ffmpeg',  
'-f', 'rawvideo',  
'-s', f'{width}x{height}',  
'-pix_fmt', 'yuv420p',  
'-i', input_file,  
'-c:v', 'libx264',  
'-b:v', f'{bit_rate}k',  
'-r', '30', # 设置输出视频的帧率为30fps  
'-f', output_format,  
'-y',  
output_file  
]  
subprocess.run(command)  
  
def compress(rate):  
  
cur_dir = "D:\多媒体实验\Lab2\source"  
file_index = get_file_index(cur_dir, '.yuv')  
# 使用enumerate()函数遍历文件字典  
for i, (file_name, file_path) in enumerate(file_index.items()):  
input_file = os.path.join(cur_dir, f'{file_name}') # 输入的YUV文件路径  
name_without_extension = os.path.splitext(file_name)[0]  
output_file = os.path.join(cur_dir, f'{name_without_extension}_{rate}.mp4') # 输出的H.264文件路径  
width = 352 # YUV图像宽度  
height = 288 # YUV图像高度  
bit_rate = rate # 比特率（单位：kbps）  
output_format = 'mp4' # 输出格式  
# print(input_file)  
# print(output_file)  
compress_yuv_with_h264(input_file, output_file, width, height, bit_rate, output_format)  
print("YUV压缩完成！")  
  
  
compress(320)  
compress(160)  
compress(80)
```

生成的视频如下图所示：
![image.png](https://wanwurong.oss-cn-beijing.aliyuncs.com/picgo/202305172001010.png)
## 3 使用H265编码器进行压缩
我用python代码调用FFmpeg进行YUV压缩，下面是代码：